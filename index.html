<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Assami Baga</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë®‚Äçüíª</text></svg>">
    
    <style>
        /* =========================================
           1. VARIABLES & TH√àMES
           ========================================= */
        :root {
            /* --- MODE CLAIR (D√©faut) --- */
            --primary: #2c3e50;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #1a252f;
            --text: #333;
            --text-muted: #666;
            --danger: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --card-border: #ddd;
            --card-hover: #f9f9f9;
            --input-bg: #fff;
            
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --glow: none;
        }

        /* --- MODE SOMBRE --- */
        body.dark-mode {
            --primary: #ecf0f1;
            --accent: #5dade2;
            --light: #2c3e50;
            --dark: #ecf0f1;
            --text: #e0e0e0;
            --text-muted: #aaa;
            --danger: #ff6b6b;
            
            --bg: #121212;
            --card-bg: #1e1e1e;
            --card-border: #333;
            --card-hover: #2a2a2a;
            --input-bg: #2c2c2c;
        }

        /* --- MODE NEURAL (IA) --- */
        body.neural-mode {
            --primary: #00d2ff;
            --accent: #3a7bd5;
            --light: #16222a;
            --dark: #00d2ff;
            --text: #e0e6ed;
            --text-muted: #8ca0b3;
            --danger: #ff6b6b;
            --success: #00ffcc;
            --warning: #f1c40f;
            
            --bg: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.85);
            --card-border: #3a7bd5;
            --card-hover: #1e293b;
            --input-bg: #0f172a;
            
            --font-main: 'Segoe UI', sans-serif;
            --glow: 0 0 10px rgba(58, 123, 213, 0.3);
        }
        body.neural-mode .sidebar, body.neural-mode .section {
            backdrop-filter: blur(5px);
            border: 1px solid rgba(58, 123, 213, 0.3);
        }

        /* --- MODE HACKER (TERMINAL) --- */
        body.hacker-mode {
            --primary: #00ff00;
            --accent: #00ff00;
            --light: #003300;
            --dark: #00ff00;
            --text: #00ff00;
            --text-muted: #00cc00;
            --danger: #ff0000;
            --success: #00ff00;
            --warning: #ffff00;
            
            --bg: #000000;
            --card-bg: #0a0a0a;
            --card-border: #00ff00;
            --card-hover: #111111;
            --input-bg: #000000;
            
            --font-main: 'Courier New', Courier, monospace;
            --glow: 0 0 4px rgba(0, 255, 0, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-main); }
        
        body { 
            background-color: var(--bg); 
            color: var(--text); 
            line-height: 1.6; 
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }
        
        body.hacker-mode * { text-shadow: var(--glow); box-shadow: none; }
        body.hacker-mode .btn-action, body.hacker-mode input, body.hacker-mode textarea { border: 1px solid #00ff00; }

        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            display: none;
            pointer-events: none;
        }

        /* =========================================
           2. ANIMATIONS SCROLL (Reveal)
           ========================================= */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s cubic-bezier(0.5, 0, 0, 1);
            will-change: opacity, transform;
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }
        .project-card:nth-child(1) { transition-delay: 0.1s; }
        .project-card:nth-child(2) { transition-delay: 0.2s; }
        .project-card:nth-child(3) { transition-delay: 0.3s; }
        .project-card:nth-child(4) { transition-delay: 0.4s; }
        
        .timeline-item.reveal { transform: translateX(-20px); }
        .timeline-item.reveal.active { transform: translateX(0); }

        /* =========================================
           3. COMPOSANTS UI
           ========================================= */
        .theme-toggle {
            position: fixed; top: 20px; left: 20px; z-index: 9999;
            background: var(--card-bg); border: 1px solid var(--card-border); color: var(--text);
            width: 45px; height: 45px; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s;
        }
        .theme-toggle:hover { transform: scale(1.1); border-color: var(--accent); }

        .translate-container { position: fixed; top: 20px; right: 20px; z-index: 9999; background: var(--card-bg); padding: 8px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid var(--card-border); }
        .goog-te-gadget-simple { background: transparent !important; border: none !important; padding: 0 !important; font-size: 14px !important; color: var(--text) !important; }
        .goog-te-banner-frame { display: none !important; }
        body { top: 0 !important; }

        .admin-controls { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 1000; align-items: flex-start; }
        .fab-btn { background: var(--accent); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s; border: none; font-size: 1.2rem; }
        .fab-btn:hover { transform: scale(1.1); }
        #save-btn, #logout-btn, #reset-btn { display: none; }
        #save-btn { background: var(--success); }
        #logout-btn { background: var(--dark); }
        #reset-btn { background: var(--danger); }

        .editable { border: 1px dashed var(--accent); background: rgba(52, 152, 219, 0.1); padding: 2px; transition: background 0.2s; cursor: text; }
        .editable:focus { background: var(--input-bg); outline: 2px solid var(--accent); border: none; color: var(--text); }
        
        .btn-action { display: none; cursor: pointer; border: none; color: white; border-radius: 5px; padding: 5px 10px; font-size: 0.8rem; margin-top: 5px; }
        .btn-delete { background-color: var(--danger); position: absolute; right: -10px; top: -10px; border-radius: 50%; width: 25px; height: 25px; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn-add { background-color: var(--success); width: 100%; margin-top: 15px; padding: 10px; display: none; text-align: center; }
        .btn-add:hover { background-color: #219150; }
        
        .task-controls { display: none; margin-left: 10px; }
        .btn-task-del { background: var(--danger); color: white; border: none; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; cursor: pointer; vertical-align: middle; }
        .btn-task-add { background: var(--accent); color: white; border: none; border-radius: 4px; padding: 2px 8px; font-size: 12px; cursor: pointer; margin-top: 5px; display: none; }

        body.logged-in .btn-delete, body.logged-in .btn-add, body.logged-in .task-controls, body.logged-in .btn-task-add { display: inline-block; }
        body.logged-in .btn-delete { display: flex; z-index: 10; }
        body.logged-in .btn-add { display: block; }
        body.logged-in .timeline-item, body.logged-in .category-box, body.logged-in .skill-tag-wrapper, body.logged-in .project-card, body.logged-in .cert-item { border: 1px solid var(--accent); padding: 10px; margin-bottom: 20px; border-radius: 8px; }
        body.logged-in #save-btn, body.logged-in #logout-btn, body.logged-in #reset-btn { display: flex; }
        body.logged-in #login-btn { display: none; }
        body.logged-in .upload-btn { display: flex; }
        body.logged-in .timeline-item { border-left: none; }
        body.logged-in .chat-widget { bottom: 300px !important; transition: bottom 0.3s ease; }

        /* =========================================
           4. LAYOUT & SECTIONS
           ========================================= */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 300px 1fr; gap: 30px; padding-top: 80px; }
        
        .sidebar { background: var(--card-bg); padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; border: 1px solid var(--card-border); }
        @media (min-width: 769px) { .sidebar { height: fit-content; align-self: start; position: sticky; top: 20px; } }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
        
        .profile-wrapper { position: relative; display: inline-block; width: 150px; height: 150px; margin-bottom: 20px; }
        .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent); }
        .upload-btn { position: absolute; bottom: 5px; right: 5px; background: var(--primary); color: white; width: 35px; height: 35px; border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white; }
        
        .name { font-size: 1.8rem; color: var(--primary); font-weight: 700; margin-bottom: 5px; }
        .title { font-size: 1rem; color: var(--accent); font-weight: 600; margin-bottom: 20px; }
        
        .contact-info { text-align: left; margin-top: 20px; font-size: 0.9rem; }
        .contact-item { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; color: var(--text); }
        .contact-item i { color: var(--accent); width: 20px; text-align: center;}
        
        .cv-download-wrapper { margin-top: 20px; margin-bottom: 20px; }
        .btn-cv { display: inline-flex; align-items: center; gap: 10px; background: var(--primary); color: white; padding: 10px 20px; border-radius: 30px; text-decoration: none; font-weight: bold; transition: all 0.3s; border: 2px solid var(--primary); cursor: pointer; }
        .btn-cv:hover { background: transparent; color: var(--primary); }
        .btn-cv.upload-mode { background: var(--warning); border-color: var(--warning); }
        
        .skills-list { text-align: left; margin-top: 30px; display: flex; flex-wrap: wrap; gap: 5px; }
        .skill-tag { background: var(--light); color: var(--dark); padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; }
        .skill-tag-wrapper { position: relative; display: inline-block; } 
        
        .main-content { display: flex; flex-direction: column; gap: 30px; }
        .section { background: var(--card-bg); padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid var(--card-border); }
        .section-title { font-size: 1.4rem; color: var(--primary); border-bottom: 2px solid var(--light); padding-bottom: 10px; margin-bottom: 20px; }
        
        .timeline-item { border-left: 3px solid var(--accent); padding-left: 20px; margin-bottom: 25px; position: relative; }
        .job-title { font-weight: bold; font-size: 1.1rem; color: var(--text); }
        .company { color: var(--text-muted); font-style: italic; font-size: 0.95rem; margin-bottom: 5px; }
        .date { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px; display: block; }
        .description ul { list-style-position: inside; margin-top: 5px; color: var(--text); }
        
        .category-box { border-left: 4px solid var(--accent); background-color: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid var(--card-border); }
        .category-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; color: var(--text); }
        .category-content { font-size: 0.9rem; color: var(--text-muted); line-height: 1.5; }
        .category-content.editable { background: var(--input-bg); padding: 10px; border-radius: 5px; line-height: 1.8; width: 100%; display: block; }
        .status-badge { background: #27ae60; color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; display: inline-block; margin-bottom: 15px;}
        
        .project-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .project-card { background: var(--card-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--card-border); position: relative; display: flex; flex-direction: column; justify-content: space-between; transition: background 0.3s; }
        .project-card:hover { background: var(--card-hover); }
        .project-header h3 { font-size: 1.1rem; color: var(--primary); margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .project-desc { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px; }
        .project-tech { font-size: 0.8rem; color: var(--accent); margin-bottom: 15px; font-style: italic; }
        .project-link { text-decoration: none; background: var(--accent); color: white; padding: 5px 15px; border-radius: 5px; font-size: 0.85rem; display: inline-block; text-align: center; width: fit-content;}
        .project-link:hover { background: var(--primary); }
        
        .cert-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .cert-item { background: var(--card-bg); padding: 15px; border-radius: 8px; display: flex; flex-direction: column; gap: 10px; position: relative; border-left: 4px solid var(--accent); border: 1px solid var(--card-border); }
        .cert-item:hover { background: var(--card-hover); }
        .cert-name { font-weight: 600; font-size: 0.95rem; color: var(--text); }
        .cert-link { font-size: 0.8rem; color: var(--accent); text-decoration: none; display: flex; align-items: center; gap: 5px; }
        
        .tech-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .tech-badges { display: flex; flex-wrap: wrap; gap: 8px; }
        .tech-tag { background: var(--bg); color: var(--text); padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; font-weight: 500; border: 1px solid var(--card-border); transition: all 0.2s; }
        .tech-tag:hover { background: var(--accent); color: white; border-color: var(--accent); }

        /* =========================================
           5. FORMULAIRE & MESSAGES & CALENDLY
           ========================================= */
        .contact-form { display: flex; flex-direction: column; gap: 15px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--card-border); background: var(--input-bg); color: var(--text); border-radius: 6px; font-size: 0.95rem; }
        .form-group textarea { resize: vertical; min-height: 120px; }
        .btn-submit { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; transition: background 0.3s; }
        .btn-submit:hover { background: var(--primary); }
        
        .btn-calendly { background: var(--success); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; width: 100%; margin-bottom: 20px; font-weight: bold; transition: transform 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .btn-calendly:hover { transform: scale(1.02); filter: brightness(1.1); color: white; }

        .messages-list { margin-top: 30px; border-top: 2px dashed var(--card-border); padding-top: 20px; }
        .message-card { background: var(--card-bg); border-left: 4px solid var(--warning); padding: 15px; margin-bottom: 15px; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; border: 1px solid var(--card-border); }
        .msg-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.85rem; color: var(--text-muted); }
        .msg-sender { font-weight: bold; color: var(--text); }
        .msg-body { color: var(--text); white-space: pre-wrap; font-size: 0.95rem; }

        /* --- CHATBOT WIDGET --- */
        .chat-widget { position: fixed; bottom: 90px; right: 20px; z-index: 9998; display: flex; flex-direction: column; align-items: flex-end; font-family: var(--font-main); }
        .chat-btn { width: 60px; height: 60px; border-radius: 50%; background: var(--accent); color: white; border: none; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; transition: transform 0.3s; }
        .chat-btn:hover { transform: scale(1.1); }

        .chat-window { width: 350px; height: 450px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.15); display: none; flex-direction: column; overflow: hidden; margin-bottom: 15px; }
        .chat-window.open { display: flex; animation: slideIn 0.3s ease-out; }

        .chat-header { background: var(--accent); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .chat-close { background: none; border: none; color: white; cursor: pointer; font-size: 1.1rem; }

        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: var(--bg); display: flex; flex-direction: column; gap: 10px; }
        .chat-message { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.4; word-wrap: break-word; }
        .chat-message.bot { align-self: flex-start; background: var(--card-bg); border: 1px solid var(--card-border); color: var(--text); border-bottom-left-radius: 2px; }
        .chat-message.user { align-self: flex-end; background: var(--accent); color: white; border-bottom-right-radius: 2px; }
        .typing-indicator { font-style: italic; color: var(--text-muted); font-size: 0.8rem; margin-left: 10px; display: none; }

        .chat-footer { padding: 10px; background: var(--card-bg); border-top: 1px solid var(--card-border); display: flex; gap: 10px; align-items: center; }
        .chat-input { flex: 1; padding: 10px; border: 1px solid var(--card-border); border-radius: 20px; background: var(--input-bg); color: var(--text); outline: none; }
        .chat-send { background: var(--accent); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.3s; }
        .chat-mic { background: var(--light); color: var(--text); border: 1px solid var(--card-border); width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .chat-mic.listening { background: var(--danger); color: white; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* =========================================
           7. VISUALISATION NEURAL (GRAPH)
           ========================================= */
        #neural-graph { width: 100%; height: 600px; border: 1px solid var(--accent); border-radius: 8px; background: rgba(15, 23, 42, 0.6); display: none; }
        body.neural-mode .tech-grid { display: none !important; }
        body.neural-mode #neural-graph { display: block !important; animation: fadeIn 1s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* =========================================
           8. TERMINAL HACKER (KONAMI & GAME)
           ========================================= */
        .terminal-trigger {
            position: fixed; top: 50%; left: 20px; transform: translateY(-50%); z-index: 10000;
            background: black; border: 2px solid #00ff00; color: #00ff00; width: 50px; height: 50px; border-radius: 8px;
            cursor: pointer; display: none; align-items: center; justify-content: center; font-size: 1.5rem;
            box-shadow: 0 0 10px #00ff00; transition: all 0.3s;
        }
        .terminal-trigger:hover { transform: translateY(-50%) scale(1.1); box-shadow: 0 0 20px #00ff00; }
        
        .terminal-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 700px; height: 500px;
            background: rgba(0, 0, 0, 0.95); border: 2px solid #00ff00; z-index: 10001; display: none; flex-direction: column;
            border-radius: 5px; box-shadow: 0 0 30px rgba(0, 255, 0, 0.2); font-family: 'Courier New', Courier, monospace;
        }
        .terminal-overlay.open { display: flex; animation: terminalPop 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        
        @keyframes terminalPop { from { opacity: 0; transform: translate(-50%, -40%) scale(0.9); } to { opacity: 1; transform: translate(-50%, -50%) scale(1); } }

        .terminal-header-bar { background: #003300; color: #00ff00; padding: 5px 10px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #00ff00; font-size: 0.9rem; font-weight: bold; }
        .terminal-close { cursor: pointer; }
        .terminal-content { flex: 1; padding: 15px; overflow-y: auto; color: #00ff00; font-size: 1rem; position: relative; }
        .terminal-line { margin-bottom: 5px; word-wrap: break-word; }
        .terminal-input-area { display: flex; align-items: center; gap: 10px; margin-top: 10px; padding: 10px; }
        .prompt { color: #00ff00; font-weight: bold; }
        #term-input { background: transparent; border: none; color: #00ff00; flex: 1; font-family: 'Courier New', Courier, monospace; font-size: 1rem; outline: none; }
        body.hacker-mode .terminal-trigger { display: flex; }

        /* SNAKE GAME CANVAS */
        #snake-canvas {
            display: none;
            background: #001100;
            border: 1px solid #00ff00;
            margin: 10px auto;
            image-rendering: pixelated;
        }

        /* =========================================
           9. PRINT MODE
           ========================================= */
        @media print {
            .admin-controls, .theme-toggle, .translate-container, .btn-action, .btn-delete, .btn-add, .task-controls,
            .cv-download-wrapper, .btn-submit, .form-group, .chat-widget, .btn-calendly, .terminal-trigger, .terminal-overlay, #neural-graph { display: none !important; }
            .tech-grid { display: grid !important; }
            body, .section, .sidebar, .category-box, .project-card, .cert-item { background: white !important; color: black !important; box-shadow: none !important; border: 1px solid #ddd !important; text-shadow: none !important; }
            .container { display: block; padding-top: 0; }
            .sidebar { margin-bottom: 20px; border: none; padding: 0; text-align: left; position: static; }
            .reveal { opacity: 1 !important; transform: none !important; }
        }
    </style>
</head>
<body>

    <button class="theme-toggle" onclick="toggleTheme()" title="Changer de th√®me (Astuce : Essayez ‚Üë ‚Üë ‚Üì ‚Üì ‚Üê ‚Üí ‚Üê ‚Üí B A)">
        <i id="theme-icon" class="fas fa-moon"></i>
    </button>
    
    <canvas id="matrix-canvas"></canvas>

    <div class="translate-container"><div id="google_translate_element"></div></div>

    <div id="app"></div>

    <div class="chat-widget">
        <div class="chat-window" id="chat-window">
            <div class="chat-header">
                <span><i class="fas fa-robot"></i> Assistant IA</span>
                <div>
                    <button class="chat-close" onclick="clearChat()" title="Effacer la discussion" style="margin-right: 10px;"><i class="fas fa-trash"></i></button>
                    <button class="chat-close" onclick="toggleChat()">‚úï</button>
                </div>
            </div>
            <div class="chat-body" id="chat-body">
                <div class="chat-message bot">Bonjour ! Je suis l'IA d'Assami. Posez-moi une question sur son parcours, ses projets ou ses technos ! ü§ñ</div>
            </div>
            <div class="typing-indicator" id="typing-indicator">L'IA √©crit...</div>
            <form class="chat-footer" onsubmit="handleChat(event)">
                <button type="button" class="chat-mic" onclick="toggleVoice()" title="Parler"><i class="fas fa-microphone"></i></button>
                <input type="text" id="chat-input" class="chat-input" placeholder="Posez votre question..." autocomplete="off">
                <button type="submit" class="chat-send"><i class="fas fa-paper-plane"></i></button>
            </form>
        </div>
        <button class="chat-btn" onclick="toggleChat()" title="Discuter avec l'IA"><i class="fas fa-comment-dots"></i></button>
    </div>

    <button class="terminal-trigger" onclick="toggleTerminal()" title="Ouvrir le Terminal">
        <i class="fas fa-terminal"></i>
    </button>

    <div class="terminal-overlay" id="terminal-overlay">
        <div class="terminal-header-bar">
            <span>root@assami-portfolio:~</span>
            <span class="terminal-close" onclick="toggleTerminal()">[X]</span>
        </div>
        <div class="terminal-content" id="terminal-content">
            <div class="terminal-line">Bienvenue dans le Terminal Interactif d'Assami v1.0.</div>
            <div class="terminal-line">Tapez 'help' pour voir les commandes disponibles.</div>
            <div class="terminal-line">Tapez 'game' pour jouer au Snake üêç.</div>
            <canvas id="snake-canvas" width="400" height="300"></canvas>
        </div>
        <div class="terminal-input-area" id="terminal-input-bar">
            <span class="prompt">visitor@assami:~$</span>
            <input type="text" id="term-input" autocomplete="off" spellcheck="false">
        </div>
    </div>

    <div class="admin-controls">
        <button id="logout-btn" class="fab-btn" onclick="logout()" title="D√©connexion"><i class="fas fa-sign-out-alt"></i></button>
        <button id="reset-btn" class="fab-btn" onclick="resetDatabase()" title="R√©initialiser (Remettre √† z√©ro)"><i class="fas fa-trash-restore"></i></button>
        <button id="save-btn" class="fab-btn" onclick="saveDataToSupabase()" title="Sauvegarder en ligne"><i class="fas fa-save"></i></button>
        <button id="login-btn" class="fab-btn" onclick="login()" title="Connexion Admin"><i class="fas fa-pen"></i></button>
    </div>

    <script>
        // ==========================================
        // 1. SUPABASE CONFIGURATION
        // ==========================================
        const SUPABASE_URL = "https://ofjbztpsifilkptuhhit.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mamJ6dHBzaWZpbGtwdHVoaGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjY4NzQsImV4cCI6MjA4Mzk0Mjg3NH0.NQDJYOPHYtQsP-XH3FVa_yYzenSzKfkO7iBu1q8dy8M";

        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const DB_TABLE = 'portfolio';
        const STORAGE_BUCKET = 'uploads';
        const CV_ID = 1;

        // ==========================================
        // 2. DONN√âES ET √âTAT
        // ==========================================
        
        const DEFAULT_DATA = {
            personal: {
                name: "Assami BAGA",
                title: "Ing√©nieur IA & Full Stack",
                availability: "Disponible d√®s octobre 2026",
                email: "bagaassami09@gmail.com",
                phone: "07 53 49 67 71",
                location: "Thiais (94320), Ile de france",
                linkedin: "assami-baga",
                social: "bagus_full_stack",
                summary: "√âtudiant en derni√®re ann√©e du cycle d'ing√©nieur en informatique √† l'EILCO, je suis √† la recherche active d'un CDI. Mon objectif est d'exploiter ma passion pour la technologie en participant √† la conception et au d√©veloppement d'applications de haute qualit√©."
            },
            softSkills: ["Polyvalence", "Efficacit√©", "Cr√©ativit√©", "Adaptabilit√©", "Collaboration", "Autonomie", "Curiosit√©"],
            languages: ["Fran√ßais", "Anglais"],
            education: [
                { degree: "Dipl√¥me d'ing√©nieur en Ing√©nierie Logicielle et Intelligence Artificielle", school: "EILCO, Calais, France", date: "Depuis septembre 2023" },
                { degree: "PUPA, LCB-FT, HDS, ISO 27001, D√©ontologie", school: "CDC Informatique, Bagneux", date: "Jan 2025 - D√©c 2025" },
                { degree: "RGPD, Protection des donn√©es, S√©curit√© incendie, HDS, ISO 27001", school: "CDC Informatique, Bagneux", date: "Jan 2024 - D√©c 2024" },
                { degree: "Technologie IP, SQL, Linux, Scripting Shell", school: "Essitech, Ouagadougou", date: "Juin 2023" },
                { degree: "Licence en Ing√©nierie des Syst√®mes d'Information", school: "ESI, Burkina Faso", date: "Oct 2019 - F√©v 2023" }
            ],
            experience: [
                {
                    role: "Ing√©nieur Exploitation",
                    company: "CDC Informatique, Bagneux",
                    date: "Depuis septembre 2024",
                    tasks: ["Participer √† un travail collaboratif", "R√©alisation de PYMQCOPY", "R√©alisation d'un R√©f√©rentiel des Services Flux (en cours)"]
                },
                {
                    role: "B√©n√©volat (Accompagnement scolaire)",
                    company: "AFEV Calais",
                    date: "Sept 2023 - Sept 2024",
                    tasks: ["Accompagnement des jeunes en difficult√© scolaire", "Cr√©ation de lien dans les quartiers populaires"]
                },
                {
                    role: "Software Engineer",
                    company: "Orange & Smile, Ouagadougou",
                    date: "Sept 2022 - Sept 2023",
                    tasks: ["D√©veloppement d'un Syst√®me Intelligent de Conception des Produits", "Participation au d√©veloppement de MySpace (Frontend)", "Participation au d√©veloppement de BourseFondation (Backend)"]
                },
                {
                    role: "Software Engineer",
                    company: "WAKATLAB, Ouagadougou",
                    date: "Sept 2021 - Oct 2021",
                    tasks: ["Participer √† un travail collaboratif avec les membres de l'√©quipe", "R√©alisation de mini projets IOT: radar, affi cheur, bargraphe, ledpoussoir, servomoteur"]
                }
            ],
            techSkills: [
                { cat: "Dev Multiplateforme", tools: "HTML, CSS, JS, TS, SASS, Bootstrap, Tailwind, WordPress, Flutter Flow, Java, Pygame, JavaFX, Angular, React, Kotlin, Docker, Tkinter, MQ Series" },
                { cat: "API RESTFUL", tools: "NodeJS, ExpressJS, Spring, FastAPI, Laravel, Keycloak, JWT, Postman, Git, Bitbucket, Swagger" },
                { cat: "Conception & Modeling", tools: "UML, Merise, Scrum, Power AMC, Adobe XD, Figma, JSON, XML, Classic Ladder" },
                { cat: "Math√©matiques & Statistiques", tools: "Alg√®bre lin√©aire, Th√©orie des graphes, Calcul diff√©rentiel, Analyse statistiques, R, Matlab" },
                { cat: "Administration de Base de Donn√©es", tools: "MySQL, MariaDB, PostgreSQL, Oracle Database, SQL Server, DBeaver" },
                { cat: "Langages de Programmation", tools: "C, Java, Javascript, TypeScript, Python, R, PHP, Kotlin, Bash, Arduino, VHDL" },
                { cat: "Machine Learning & Deep Learning", tools: "CNN, RNN, AE, GAN, NLP, TensorFlow, Scikit-learn, PyTorch, Keras, YOLO, Fidle, N8N, Pandas, NumPy, Seaborn, Matplotlib, Power BI, JupyterNotebook" }
            ],
            projects: [
                { name: "Blue Attendance", desc: "Liste de pr√©sence √©lectronique via Bluetooth (App Mobile).", tech: "Java, Xml, FastAPI, Android Studio", link: "#" },
                { name: "PNP+", desc: "Syst√®me Intelligent de Conception des Produits et Promotions.", tech: "Angular, Spring boot, SQL", link: "#" },
                { name: "Myspace", desc: "Plateforme SaaS compl√®te.", tech: "React, Node.js, PostgreSQL", link: "#" },
                { name: "BourseFondation", desc: "Plateforme SaaS compl√®te.", tech: "React, Node.js, PostgreSQL", link: "#" },
                { name: "UI Calculator", desc: "Application web UI UX Design.", tech: "HTML, CSS, SCSS", link: "#" },
                { name: "UI Keyboard", desc: "Application web UI UX Design.", tech: "HTML, CSS, SCSS", link: "#" },
                { name: "Projet IOT", desc: "Plateforme SaaS compl√®te IOT.", tech: "React, Node.js, PostgreSQL", link: "#" },
                { name: "ESI Website", desc: "Site web statique de l'ESI.", tech: "HTML, CSS, Bootstrap", link: "#" },
                { name: "Checkers Game", desc: "Jeu de dames en mode console.", tech: "C, Linux", link: "#" },
                { name: "Todo List", desc: "Todo-list avec auth et email verification.", tech: "PHP, Laravel, Voyager", link: "#" },
                { name: "Technology Transfer", desc: "Plateforme de transfert de technologies.", tech: "HTML, CSS, Bootstrap, MySql", link: "#" },
                { name: "Spare", desc: "Suivi budg√©taire (synchro bancaire).", tech: "React, Node.js, Firebase", link: "#" },
                { name: "PYMQCOPY", desc: "Recopie de messages MQ source vers destinations.", tech: "Python, MQ Series, Bash", link: "#" }
            ],
            certifications: [
                { name: "C", link: "#" },
                { name: "HTML", link: "#" },
                { name: "CSS", link: "#" },
                { name: "Javascript", link: "#" },
                { name: "Java", link: "#" },
                { name: "PHP", link: "#" },
                { name: "SQL", link: "#" },
                { name: "Python for Beginner", link: "#" },
                { name: "Python Data Structures", link: "#" },
                { name: "Coding marketers", link: "#" },
                { name: "Responsive Web Design", link: "#" },
                { name: "Intro r√©f√©rentiel HDS & ISO 27001", link: "#" },
                { name: "Sensibilisation PUPA", link: "#" },
                { name: "Fondamentaux de la LCB-FT", link: "#" },
                { name: "RGPD - Protection donn√©es", link: "#" },
                { name: "Classification et protection donn√©es", link: "#" },
                { name: "D√©ontologie code", link: "#" },
                { name: "Evacuation et s√©curit√© incendie", link: "#" }
            ]
        };

        let user = null;
        let cvData = DEFAULT_DATA;
        let messages = [];

        // ==========================================
        // 3. INITIALISATION & AUTH
        // ==========================================

        async function init() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session) {
                user = session.user;
                enableEditMode();
                loadMessages();
            }

            await loadData();
            initTheme();
            await handleVisits();
        }

        async function loadData() {
            try {
                const { data, error } = await supabaseClient.from(DB_TABLE).select('json_data').eq('id', CV_ID).single();
                if (data && data.json_data) {
                    cvData = data.json_data;
                }
                render();
            } catch (err) { console.warn(err); render(); }
        }

        async function login() {
            const email = prompt("Email Admin :");
            const password = prompt("Mot de passe :");
            if (!email || !password) return;

            const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
            if (error) {
                alert("‚ùå Erreur : " + error.message);
            } else {
                user = data.user;
                enableEditMode();
                alert("‚úÖ Connect√© !");
                loadData();
                loadMessages();
            }
        }

        async function logout() {
            await supabaseClient.auth.signOut();
            user = null;
            disableEditMode();
            alert("D√©connect√©.");
        }

        function enableEditMode() { document.body.classList.add('logged-in'); render(); }
        function disableEditMode() { document.body.classList.remove('logged-in'); render(); }

        // ==========================================
        // 4. SAUVEGARDE & UPLOAD
        // ==========================================

        async function saveDataToSupabase() {
            if (!user) return alert("Connexion requise");
            const { error } = await supabaseClient.from(DB_TABLE).upsert({ id: CV_ID, json_data: cvData });
            if (error) alert("‚ùå Erreur: " + error.message);
            else alert("‚úÖ Sauvegard√© !");
        }

        async function uploadFileToSupabase(file) {
            if (!user) return null;
            const fileName = `${Date.now()}_${file.name.replace(/\s/g, '_')}`;
            const { error } = await supabaseClient.storage.from(STORAGE_BUCKET).upload(fileName, file);
            if (error) { alert("Erreur upload: " + error.message); return null; }
            const { data } = supabaseClient.storage.from(STORAGE_BUCKET).getPublicUrl(fileName);
            return data.publicUrl;
        }
        
        async function resetDatabase() {
            if (!user || !confirm("‚ö†Ô∏è Tout effacer et remettre √† z√©ro ?")) return;
            await supabaseClient.from(DB_TABLE).upsert({ id: CV_ID, json_data: DEFAULT_DATA });
            await supabaseClient.from('site_stats').upsert({ id: 1, visits: 0 });
            cvData = JSON.parse(JSON.stringify(DEFAULT_DATA));
            document.getElementById('visit-count').innerText = "0";
            alert("‚ôªÔ∏è R√©initialis√© !");
            render();
        }

        // ==========================================
        // 5. GESTION DES MESSAGES
        // ==========================================
        async function loadMessages() {
            if (!user) return;
            const { data, error } = await supabaseClient.from('messages').select('*').order('created_at', { ascending: false });
            if (!error) { messages = data || []; render(); }
        }

        async function handleContactSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const formData = { name: form.name.value, email: form.email.value, message: form.message.value };
            const btn = form.querySelector('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = "Envoi en cours...";
            btn.disabled = true;

            const { error } = await supabaseClient.from('messages').insert(formData);
            if (error) { alert("‚ùå Erreur : " + error.message); } 
            else { alert("‚úÖ Message envoy√© !"); form.reset(); if(user) loadMessages(); }
            btn.innerHTML = originalText;
            btn.disabled = false;
        }

        async function deleteMessage(id) {
            if(!confirm("Supprimer ce message ?")) return;
            const { error } = await supabaseClient.from('messages').delete().eq('id', id);
            if (error) alert("Erreur"); else loadMessages();
        }

        // ==========================================
        // 6. GESTION DES TH√àMES, CANVAS & GRAPH
        // ==========================================

        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        let animationId; 
        let network = null;

        // --- A. MATRIX ---
        function startMatrix() {
            stopAnimation(); 
            canvas.style.display = 'block';
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const chars = "01010101ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            const drops = Array(Math.floor(columns)).fill(1);
            function drawMatrix() {
                ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "#0F0";
                ctx.font = fontSize + "px monospace";
                for (let i = 0; i < drops.length; i++) {
                    const text = chars[Math.floor(Math.random() * chars.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                }
                animationId = requestAnimationFrame(drawMatrix);
            }
            drawMatrix();
        }

        // --- B. NEURAL PARTICLES ---
        let particles = [];
        function startNeural() {
            stopAnimation();
            canvas.style.display = 'block';
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const particleCount = Math.min(100, (canvas.width * canvas.height) / 9000); 
            particles = [];
            for (let i = 0; i < particleCount; i++) {
                particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, vx: (Math.random() - 0.5) * 1.5, vy: (Math.random() - 0.5) * 1.5, size: Math.random() * 2 + 1 });
            }
            function drawNeural() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "#00d2ff";
                ctx.strokeStyle = "rgba(0, 210, 255, 0.15)";
                ctx.lineWidth = 1;
                for (let i = 0; i < particles.length; i++) {
                    let p = particles[i]; p.x += p.vx; p.y += p.vy;
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
                    for (let j = i + 1; j < particles.length; j++) {
                        let p2 = particles[j]; let dx = p.x - p2.x; let dy = p.y - p2.y; let distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 120) { ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke(); }
                    }
                }
                animationId = requestAnimationFrame(drawNeural);
            }
            drawNeural();
        }

        function stopAnimation() {
            if (animationId) cancelAnimationFrame(animationId);
            canvas.style.display = 'none';
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function initNeuralGraph() {
            const container = document.getElementById('neural-graph');
            if (!container) return;

            const nodes = []; const edges = []; let idCounter = 1;
            nodes.push({ id: 0, label: "Assami", color: "#e74c3c", size: 40, shape: "circle", font: { color: "white", size: 20 } });

            (cvData.techSkills || []).forEach((cat, i) => {
                const catId = idCounter++;
                nodes.push({ id: catId, label: cat.cat, color: "#3498db", size: 25, shape: "dot", font: { color: "#00d2ff", size: 16 } });
                edges.push({ from: 0, to: catId, color: { color: "rgba(52, 152, 219, 0.4)" } });
                const tools = cat.tools.split(',');
                tools.forEach(tool => {
                    const toolId = idCounter++;
                    nodes.push({ id: toolId, label: tool.trim(), color: "#16222a", shape: "dot", size: 10, font: { color: "#ecf0f1", size: 14 } });
                    edges.push({ from: catId, to: toolId, color: { color: "rgba(58, 123, 213, 0.2)" } });
                });
            });

            const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
            const options = {
                nodes: { borderWidth: 2, borderWidthSelected: 4, shadow: true },
                edges: { width: 1, smooth: { type: "continuous" } },
                physics: { stabilization: false, barnesHut: { gravitationalConstant: -3000, springConstant: 0.04, springLength: 95 } },
                interaction: { hover: true, zoomView: false }
            };

            if(network) network.destroy();
            network = new vis.Network(container, data, options);
            network.once("stabilizationIterationsDone", function() { network.fit({ animation: { duration: 1000 } }); });
        }

        function toggleTheme() {
            const body = document.body;
            let newTheme = 'light';
            if(body.classList.contains('hacker-mode')) {
                document.getElementById('terminal-overlay').classList.remove('open');
                stopSnakeGame();
            }

            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode'); body.classList.add('neural-mode'); newTheme = 'neural';
                startNeural(); setTimeout(initNeuralGraph, 100); 
            } else if (body.classList.contains('neural-mode')) {
                body.classList.remove('neural-mode'); body.classList.add('hacker-mode'); newTheme = 'hacker';
                startMatrix();
            } else if (body.classList.contains('hacker-mode')) {
                body.classList.remove('hacker-mode'); newTheme = 'light';
                stopAnimation();
            } else {
                body.classList.add('dark-mode'); newTheme = 'dark';
                stopAnimation();
            }
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
            if(!icon) return;
            icon.className = 'fas'; icon.style.color = "";
            if (theme === 'dark') { icon.classList.add('fa-sun'); icon.style.color = "#f1c40f"; } 
            else if (theme === 'neural') { icon.classList.add('fa-brain'); icon.style.color = "#00d2ff"; } 
            else if (theme === 'hacker') { icon.classList.add('fa-terminal'); icon.style.color = "#00ff00"; } 
            else { icon.classList.add('fa-moon'); }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') document.body.classList.add('dark-mode');
            else if (savedTheme === 'neural') { document.body.classList.add('neural-mode'); startNeural(); setTimeout(initNeuralGraph, 500); }
            else if (savedTheme === 'hacker') { document.body.classList.add('hacker-mode'); startMatrix(); }
            updateThemeIcon(savedTheme || 'light');
        }

        window.addEventListener('resize', () => {
            const body = document.body;
            if (body.classList.contains('hacker-mode')) startMatrix();
            if (body.classList.contains('neural-mode')) startNeural();
        });

        // ==========================================
        // 7. RENDER
        // ==========================================
        function render() {
            const app = document.getElementById('app');
            const isEditing = !!user;
            const editClass = isEditing ? 'editable' : '';
            const contentEditable = isEditing ? 'contenteditable="true"' : '';
            const delBtn = (type, index) => `<button class="btn-action btn-delete" onclick="deleteItem('${type}', ${index})"><i class="fas fa-trash"></i></button>`;

            const p = cvData.personal || {};
            const photoSrc = p.photoUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(p.name)}&background=3498db&color=fff&size=150`;

            app.innerHTML = `
                <div class="container">
                    <aside class="sidebar">
                        <div class="profile-wrapper">
                            <img src="${photoSrc}" alt="Profile" class="profile-img">
                            <label for="photo-upload" class="upload-btn"><i class="fas fa-camera"></i></label>
                            <input type="file" id="photo-upload" accept="image/*" style="display:none">
                        </div>
                        <h1 class="name ${editClass}" ${contentEditable} oninput="updatePersonal('name', this.innerText)">${p.name}</h1>
                        <p class="title ${editClass}" ${contentEditable} oninput="updatePersonal('title', this.innerText)">${p.title}</p>
                        <div class="status-badge ${editClass}" ${contentEditable} oninput="updatePersonal('availability', this.innerText)">${p.availability}</div>
                        
                        <div class="contact-info">
                            <div class="contact-item"><i class="fas fa-envelope"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('email', this.innerText)">${p.email}</span></div>
                            <div class="contact-item"><i class="fas fa-phone"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('phone', this.innerText)">${p.phone}</span></div>
                            <div class="contact-item"><i class="fas fa-map-marker-alt"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('location', this.innerText)">${p.location}</span></div>
                            <div class="contact-item"><i class="fab fa-linkedin"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('linkedin', this.innerText)">${p.linkedin}</span></div>
                            <div class="contact-item"><i class="fab fa-github"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('social', this.innerText)">${p.social}</span></div>
                        </div>

                        <div style="margin-top: 20px; font-size: 0.85rem; color: var(--text-muted); border-top: 1px solid var(--card-border); padding-top: 10px;">
                            <i class="fas fa-eye" style="color: var(--accent);"></i> Vues : <b id="visit-count">...</b>
                        </div>
                        
                        <div class="cv-download-wrapper">
                            <a href="${p.cvUrl || '#'}" class="btn-cv ${isEditing ? 'upload-mode' : ''}" ${isEditing ? 'onclick="document.getElementById(\'cv-upload\').click(); return false;"' : 'target="_blank"'}>
                                <i class="fas ${isEditing ? 'fa-file-upload' : 'fa-download'}"></i> ${isEditing ? 'Uploader CV' : 'T√©l√©charger CV'}
                            </a>
                            <input type="file" id="cv-upload" accept="application/pdf" style="display:none">
                        </div>
                        
                        <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--card-border);">
                        
                        <h3>Atouts</h3>
                        <div class="skills-list">${(cvData.softSkills || []).map((s, i) => `<div class="skill-tag-wrapper"><span class="skill-tag ${editClass}" ${contentEditable} oninput="updateArrayItem('softSkills', ${i}, null, this.innerText)">${s}</span>${delBtn('softSkills', i)}</div>`).join('')}</div>
                        <button class="btn-action btn-add" onclick="addItem('softSkills')"><i class="fas fa-plus"></i> Ajouter</button>
                        
                        <h3 style="margin-top:20px">Langues</h3>
                        <div class="skills-list">${(cvData.languages || []).map((s, i) => `<div class="skill-tag-wrapper"><span class="skill-tag ${editClass}" ${contentEditable} oninput="updateArrayItem('languages', ${i}, null, this.innerText)">${s}</span>${delBtn('languages', i)}</div>`).join('')}</div>
                        <button class="btn-action btn-add" onclick="addItem('languages')"><i class="fas fa-plus"></i> Ajouter</button>
                    </aside>
                    
                    <main class="main-content">
                        <section class="section">
                            <h2 class="section-title">‚ÑπÔ∏è √Ä propos de moi</h2>
                            <p class="${editClass}" ${contentEditable} oninput="updatePersonal('summary', this.innerText)">${p.summary}</p>
                        </section>

                        <section class="section">
                            <h2 class="section-title">üéì Dipl√¥mes et Formations</h2>
                            ${(cvData.education || []).map((edu, i) => `
                                <div class="timeline-item">
                                    ${delBtn('education', i)}
                                    <div class="job-title ${editClass}" ${contentEditable} oninput="updateArrayItem('education', ${i}, 'degree', this.innerText)">${edu.degree}</div>
                                    <div class="company ${editClass}" ${contentEditable} oninput="updateArrayItem('education', ${i}, 'school', this.innerText)">${edu.school}</div>
                                    <span class="date ${editClass}" ${contentEditable} oninput="updateArrayItem('education', ${i}, 'date', this.innerText)">${edu.date}</span>
                                </div>`).join('')}
                            <button class="btn-action btn-add" onclick="addItem('education')"><i class="fas fa-plus"></i> Ajouter</button>
                        </section>

                        <section class="section">
                            <h2 class="section-title">üíª Comp√©tences Techniques</h2>
                            <div id="neural-graph"></div>
                            <div class="tech-grid">
                                ${(cvData.techSkills || []).map((skill, i) => { 
                                    const contentHtml = isEditing 
                                        ? `<div class="category-content ${editClass}" ${contentEditable} oninput="updateArrayItem('techSkills', ${i}, 'tools', this.innerText)">${skill.tools}</div>` 
                                        : `<div class="tech-badges">${skill.tools.split(',').map(t => `<span class="tech-tag">${t.trim()}</span>`).join('')}</div>`;
                                    return `
                                    <div class="category-box">
                                        ${delBtn('techSkills', i)}
                                        <div class="category-title ${editClass}" ${contentEditable} oninput="updateArrayItem('techSkills', ${i}, 'cat', this.innerText)">${skill.cat}</div>
                                        ${contentHtml}
                                    </div>`;
                                }).join('')}
                            </div>
                            <button class="btn-action btn-add" onclick="addItem('techSkills')"><i class="fas fa-plus"></i> Ajouter</button>
                        </section>
                        
                        <section class="section">
                            <h2 class="section-title">üíº Exp√©riences Professionnelles</h2>
                            ${(cvData.experience || []).map((exp, i) => `
                                <div class="timeline-item">
                                    ${delBtn('experience', i)}
                                    <div class="job-title ${editClass}" ${contentEditable} oninput="updateArrayItem('experience', ${i}, 'role', this.innerText)">${exp.role}</div>
                                    <div class="company ${editClass}" ${contentEditable} oninput="updateArrayItem('experience', ${i}, 'company', this.innerText)">${exp.company}</div>
                                    <span class="date ${editClass}" ${contentEditable} oninput="updateArrayItem('experience', ${i}, 'date', this.innerText)">${exp.date}</span>
                                    <div class="description">
                                        <ul>
                                            ${(exp.tasks || []).map((t, ti) => `<li><span class="${editClass}" ${contentEditable} oninput="updateTask(${i}, ${ti}, this.innerText)">${t}</span><span class="task-controls"><button class="btn-task-del" onclick="deleteTask(${i}, ${ti})">x</button></span></li>`).join('')}
                                        </ul>
                                        <button class="btn-task-add" onclick="addTask(${i})">+ T√¢che</button>
                                    </div>
                                </div>`).join('')}
                            <button class="btn-action btn-add" onclick="addItem('experience')"><i class="fas fa-plus"></i> Ajouter</button>
                        </section>

                        <section class="section">
                            <h2 class="section-title">üèÜ Projets Phares</h2>
                            <div class="project-grid">
                                ${(cvData.projects || []).map((proj, i) => `
                                    <div class="project-card">
                                        ${delBtn('projects', i)}
                                        <div class="project-header"><h3 class="${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'name', this.innerText)"><i class="fas fa-robot"></i> ${proj.name}</h3></div>
                                        <p class="project-desc ${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'desc', this.innerText)">${proj.desc}</p>
                                        <div class="project-tech ${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'tech', this.innerText)">${proj.tech}</div>
                                        <a href="${isEditing ? '#' : proj.link}" target="${isEditing ? '_self' : '_blank'}" class="project-link" ${isEditing ? 'onclick="event.preventDefault();"' : ''}><span class="${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'link', this.innerText)">${isEditing ? proj.link : 'Voir le projet'}</span></a>
                                    </div>`).join('')}
                            </div>
                            <button class="btn-action btn-add" onclick="addItem('projects')"><i class="fas fa-plus"></i> Ajouter un projet</button>
                        </section>
                        
                        <section class="section">
                            <h2 class="section-title">üìä Mes Certifications</h2>
                            <div class="cert-grid">
                                ${(cvData.certifications || []).map((cert, i) => `
                                    <div class="cert-item">
                                        ${delBtn('certifications', i)}
                                        <div class="cert-name ${editClass}" ${contentEditable} oninput="updateArrayItem('certifications', ${i}, 'name', this.innerText)">${cert.name}</div>
                                        <a href="${isEditing ? '#' : cert.link}" target="${isEditing ? '_self' : '_blank'}" class="cert-link" ${isEditing ? 'onclick="event.preventDefault();"' : ''}><i class="fas fa-external-link-alt"></i><span class="${editClass}" ${contentEditable} oninput="updateArrayItem('certifications', ${i}, 'link', this.innerText)">${isEditing ? cert.link : 'Voir'}</span></a>
                                    </div>`).join('')}
                            </div>
                            <button class="btn-action btn-add" onclick="addItem('certifications')"><i class="fas fa-plus"></i> Ajouter</button>
                        </section>

                        <section class="section" id="contact">
                            <h2 class="section-title">üì¨ Me Contacter</h2>
                            <a href="https://calendly.com/bagaassami09/30min" target="_blank" class="btn-calendly"><i class="fas fa-calendar-alt"></i> üìÖ R√©server un appel</a>
                            <form class="contact-form" onsubmit="handleContactSubmit(event)">
                                <div class="form-group"><input type="text" name="name" placeholder="Votre nom" required></div>
                                <div class="form-group"><input type="email" name="email" placeholder="Votre email" required></div>
                                <div class="form-group"><textarea name="message" placeholder="Votre message..." required></textarea></div>
                                <button type="submit" class="btn-submit"><i class="fas fa-paper-plane"></i> Envoyer le message</button>
                            </form>
                            ${isEditing ? `
                                <div class="messages-list">
                                    <h3 style="margin-bottom:15px; color:var(--warning)"><i class="fas fa-inbox"></i> Messages re√ßus (${messages.length})</h3>
                                    ${messages.map(msg => `<div class="message-card"><button class="btn-delete" onclick="deleteMessage(${msg.id})" style="top:5px; right:5px; display:flex;"><i class="fas fa-trash"></i></button><div class="msg-header"><span class="msg-sender"><i class="fas fa-user"></i> ${msg.name} (${msg.email})</span><span>${new Date(msg.created_at).toLocaleDateString()}</span></div><div class="msg-body">${msg.message}</div></div>`).join('')}
                                </div>` : ''}
                        </section>
                    </main>
                </div>
            `;
            initScrollAnimations();
            attachListeners();
        }

        function initScrollAnimations() {
            const elementsToAnimate = document.querySelectorAll('.section, .timeline-item, .project-card, .category-box, .cert-item');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('active'); observer.unobserve(entry.target); } });
            }, { threshold: 0.1, rootMargin: "0px 0px -50px 0px" });
            elementsToAnimate.forEach(el => { el.classList.add('reveal'); observer.observe(el); });
        }

        function updatePersonal(f, v) { cvData.personal[f] = v; }
        function updateArrayItem(arr, idx, f, v) { if(f) cvData[arr][idx][f] = v; else cvData[arr][idx] = v; }
        function updateTask(expIndex, taskIndex, val) { cvData.experience[expIndex].tasks[taskIndex] = val; }
        function addTask(expIndex) { if(!cvData.experience[expIndex].tasks) cvData.experience[expIndex].tasks = []; cvData.experience[expIndex].tasks.push("Nouvelle t√¢che..."); render(); }
        function deleteTask(expIndex, taskIndex) { if(confirm("Supprimer t√¢che ?")) { cvData.experience[expIndex].tasks.splice(taskIndex, 1); render(); } }
        function addItem(type) {
            const map = { experience: { role: "Nouveau poste", company: "Entreprise", date: "Date", tasks: ["T√¢che 1"] }, education: { degree: "Dipl√¥me", school: "√âcole", date: "Date" }, techSkills: { cat: "Cat√©gorie", tools: "Outils" }, projects: { name: "Nouveau Projet", desc: "Description", tech: "Technos", link: "#" }, certifications: { name: "Nouvelle Certif", link: "#" }, softSkills: "Nouvel atout", languages: "Langue" };
            if(!cvData[type]) cvData[type] = []; cvData[type].unshift(map[type]); render();
        }
        function deleteItem(t, i) { if(confirm("Supprimer √©l√©ment ?")) { cvData[t].splice(i, 1); render(); } }

        function attachListeners() {
            const pi = document.getElementById('photo-upload');
            if(pi) pi.onchange = async (e) => { const f = e.target.files[0]; if(f) { const url = await uploadFileToSupabase(f); if(url) { cvData.personal.photoUrl = url; render(); } } };
            const ci = document.getElementById('cv-upload');
            if(ci) ci.onchange = async (e) => { const f = e.target.files[0]; if(f) { const url = await uploadFileToSupabase(f); if(url) { cvData.personal.cvUrl = url; alert("CV Upload√© !"); render(); } } };
        }

        async function handleVisits() {
            if (!sessionStorage.getItem('visited')) { await supabaseClient.rpc('increment_visits'); sessionStorage.setItem('visited', 'true'); }
            const { data } = await supabaseClient.from('site_stats').select('visits').single();
            if (data && document.getElementById('visit-count')) document.getElementById('visit-count').innerText = data.visits;
        }

        // ==========================================
        // 8. CHATBOT & VOICE
        // ==========================================
        function toggleChat() {
            const w = document.getElementById('chat-window'); w.classList.toggle('open');
            if(w.classList.contains('open')) document.getElementById('chat-input').focus();
        }
        function clearChat() { document.getElementById('chat-body').innerHTML = '<div class="chat-message bot">Bonjour ! Je suis l\'IA d\'Assami. Posez-moi une question sur son parcours, ses projets ou ses technos ! ü§ñ</div>'; }

        function findLocalResponse(input) {
            const text = input.toLowerCase(); const p = cvData.personal || {};
            if (text.match(/secret|hacker|console|terminal|code|admin|cach√©/)) return "Shhh ü§´ ! Si vous voulez acc√©der au syst√®me, tapez le Konami Code : ‚Üë ‚Üë ‚Üì ‚Üì ‚Üê ‚Üí ‚Üê ‚Üí B A";
            if (text.match(/contact|email|mail|t√©l√©phone|tel|joindre/)) return `Vous pouvez me contacter par :\n- Email : ${p.email}\n- T√©l : ${p.phone}\n- LinkedIn : ${p.linkedin}`;
            if (text.match(/dispo|quand|date|d√©but|libre/)) return `Je suis actuellement : ${p.availability}.`;
            if (text.match(/techno|stack|langage|outil|comp√©tence/)) return `Voici un aper√ßu de ma stack : ${(cvData.techSkills || []).map(s => s.tools).join(', ').substring(0, 100)}...`;
            if (text.match(/projet|r√©alisation|portfolio/)) return `J'ai travaill√© sur plusieurs projets, voir la section "Projets Phares".`;
            return null;
        }

        async function handleChat(e) {
            e.preventDefault(); const inputField = document.getElementById('chat-input'); const msg = inputField.value.trim(); if (!msg) return;
            addMessage(msg, 'user'); inputField.value = ''; document.getElementById('typing-indicator').style.display = 'block';
            try {
                const { data, error } = await supabaseClient.functions.invoke('chat-resume', { body: { question: msg, context: cvData } });
                if (error) throw error; document.getElementById('typing-indicator').style.display = 'none'; addMessage(data.reply, 'bot');
            } catch (err) {
                console.warn("IA Error", err); document.getElementById('typing-indicator').style.display = 'none';
                const localReply = findLocalResponse(msg);
                if (localReply) addMessage(localReply + " (Note: R√©ponse hors-ligne üîå)", 'bot');
                else addMessage("D√©sol√©, je ne peux pas joindre l'IA. Essayez 'Contact', 'Stack' ou 'Projets'.", 'bot');
            }
        }
        function addMessage(text, sender) {
            const body = document.getElementById('chat-body'); const div = document.createElement('div'); div.className = `chat-message ${sender}`; div.innerText = text; body.appendChild(div); body.scrollTop = body.scrollHeight; 
        }

        // VOICE DICTATION
        function toggleVoice() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) { alert("Votre navigateur ne supporte pas la reconnaissance vocale."); return; }
            const micBtn = document.querySelector('.chat-mic');
            const recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR'; recognition.interimResults = false; recognition.maxAlternatives = 1;

            micBtn.classList.add('listening');
            recognition.start();

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                document.getElementById('chat-input').value = text;
                micBtn.classList.remove('listening');
                // Auto submit ? Optionnel: handleChat({ preventDefault: ()=>{} });
            };
            recognition.onspeechend = () => { recognition.stop(); micBtn.classList.remove('listening'); };
            recognition.onerror = () => { micBtn.classList.remove('listening'); alert("Erreur vocale."); };
        }

        // ==========================================
        // 9. KONAMI, TERMINAL & SNAKE GAME
        // ==========================================
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;
        let isSnakePlaying = false;
        let snakeGameInterval;
        let snake = [];
        let food = {};
        let snakeDir = 'RIGHT';
        let snakeScore = 0;

        document.addEventListener('keydown', (e) => {
            // Si le Snake tourne, on emp√™che le scroll et on g√®re le jeu
            if (isSnakePlaying) {
                if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();
                if(e.key === 'ArrowUp' && snakeDir !== 'DOWN') snakeDir = 'UP';
                else if(e.key === 'ArrowDown' && snakeDir !== 'UP') snakeDir = 'DOWN';
                else if(e.key === 'ArrowLeft' && snakeDir !== 'RIGHT') snakeDir = 'LEFT';
                else if(e.key === 'ArrowRight' && snakeDir !== 'LEFT') snakeDir = 'RIGHT';
                else if(e.key === 'Escape' || e.key.toLowerCase() === 'q') stopSnakeGame();
                return;
            }
            // Sinon logique Konami
            if (e.key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) { activateHackerTerminal(); konamiIndex = 0; }
            } else { konamiIndex = 0; }
        });

        function activateHackerTerminal() {
            document.body.classList.remove('dark-mode', 'neural-mode'); document.body.classList.add('hacker-mode'); localStorage.setItem('theme', 'hacker'); updateThemeIcon('hacker'); startMatrix();
            toggleTerminal(); writeToTerminal(">> ACCESS GRANTED. WELCOME, USER.");
        }

        function toggleTerminal() {
            const term = document.getElementById('terminal-overlay'); 
            const input = document.getElementById('term-input');
            term.classList.toggle('open'); 
            if(term.classList.contains('open')) input.focus();
            else stopSnakeGame();
        }

        function writeToTerminal(text) {
            const content = document.getElementById('terminal-content'); const div = document.createElement('div'); div.className = 'terminal-line'; div.innerText = text; content.appendChild(div); content.scrollTop = content.scrollHeight;
        }

        document.getElementById('term-input').addEventListener('keydown', function(e) {
            if(e.key === 'Enter') { const cmd = this.value.trim().toLowerCase(); if(cmd) { writeToTerminal(`visitor@assami:~$ ${cmd}`); processCommand(cmd); } this.value = ''; }
        });

        function processCommand(cmd) {
            const p = cvData.personal || {};
            switch(cmd) {
                case 'help': writeToTerminal("Available: whoami, skills, projects, contact, game, clear, exit"); break;
                case 'whoami': writeToTerminal(`USER: ${p.name}\nROLE: ${p.title}\nSTATUS: ${p.availability}`); break;
                case 'contact': writeToTerminal(`EMAIL: ${p.email}\nPHONE: ${p.phone}`); break;
                case 'skills': (cvData.techSkills || []).forEach(c => writeToTerminal(`[${c.cat}]: ${c.tools.substring(0, 50)}...`)); break;
                case 'projects': (cvData.projects || []).slice(0, 5).forEach(proj => writeToTerminal(`* ${proj.name} - ${proj.tech}`)); break;
                case 'clear': document.getElementById('terminal-content').innerHTML = ''; break;
                case 'exit': toggleTerminal(); break;
                case 'game': case 'snake': startSnakeGame(); break;
                default: writeToTerminal(`Command not found: ${cmd}`);
            }
        }

        // --- SNAKE GAME LOGIC ---
        function startSnakeGame() {
            isSnakePlaying = true;
            document.getElementById('snake-canvas').style.display = 'block';
            document.getElementById('terminal-input-bar').style.display = 'none'; // Cache l'input pendant le jeu
            writeToTerminal(">> LAUNCHING SNAKE... (Use Arrows to move, ESC to quit)");
            
            const canvas = document.getElementById('snake-canvas');
            const ctx = canvas.getContext('2d');
            const box = 20; 
            snake = []; snake[0] = { x: 10 * box, y: 10 * box };
            food = { x: Math.floor(Math.random() * (canvas.width/box)) * box, y: Math.floor(Math.random() * (canvas.height/box)) * box };
            snakeDir = 'RIGHT';
            snakeScore = 0;

            if(snakeGameInterval) clearInterval(snakeGameInterval);
            snakeGameInterval = setInterval(drawSnakeGame, 100);
        }

        function stopSnakeGame() {
            isSnakePlaying = false;
            if(snakeGameInterval) clearInterval(snakeGameInterval);
            document.getElementById('snake-canvas').style.display = 'none';
            document.getElementById('terminal-input-bar').style.display = 'flex';
            document.getElementById('term-input').focus();
            writeToTerminal(">> GAME OVER. Score: " + snakeScore);
        }

        function drawSnakeGame() {
            const canvas = document.getElementById('snake-canvas');
            const ctx = canvas.getContext('2d');
            const box = 20;

            // Fond
            ctx.fillStyle = "#001100";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Snake
            for(let i = 0; i < snake.length; i++) {
                ctx.fillStyle = (i === 0) ? "#00FF00" : "#00AA00";
                ctx.fillRect(snake[i].x, snake[i].y, box, box);
                ctx.strokeStyle = "#000";
                ctx.strokeRect(snake[i].x, snake[i].y, box, box);
            }

            // Food
            ctx.fillStyle = "red";
            ctx.fillRect(food.x, food.y, box, box);

            // Logic Position
            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            if(snakeDir == "LEFT") snakeX -= box;
            if(snakeDir == "UP") snakeY -= box;
            if(snakeDir == "RIGHT") snakeX += box;
            if(snakeDir == "DOWN") snakeY += box;

            // Manger
            if(snakeX == food.x && snakeY == food.y) {
                snakeScore++;
                food = { x: Math.floor(Math.random() * (canvas.width/box)) * box, y: Math.floor(Math.random() * (canvas.height/box)) * box };
            } else {
                snake.pop();
            }

            // Game Over Rules
            if(snakeX < 0 || snakeX >= canvas.width || snakeY < 0 || snakeY >= canvas.height || collision(snakeX, snakeY, snake)) {
                stopSnakeGame();
                return;
            }

            let newHead = { x: snakeX, y: snakeY };
            snake.unshift(newHead);

            // Score Draw
            ctx.fillStyle = "white";
            ctx.font = "16px Courier New";
            ctx.fillText("Score: " + snakeScore, 10, 20);
        }

        function collision(x, y, array) {
            for(let i = 0; i < array.length; i++) {
                if(x == array[i].x && y == array[i].y) return true;
            }
            return false;
        }

        // INIT
        init();
        console.log("%cüïµÔ∏è Vous inspectez le code ?","color: #3498db; font-size: 16px; font-weight: bold;");
        console.log("%cEssayez le Konami Code : ‚Üë ‚Üë ‚Üì ‚Üì ‚Üê ‚Üí ‚Üê ‚Üí B A","color: #e74c3c; font-size: 12px;");
    </script>
    
    <script>function googleTranslateElementInit() { new google.translate.TranslateElement({pageLanguage: 'fr', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element'); }</script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>