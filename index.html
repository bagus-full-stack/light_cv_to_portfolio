<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Assami Baga</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* [VOTRE CSS EST CONSERV√â √Ä L'IDENTIQUE] */
        :root { --primary: #2c3e50; --accent: #3498db; --light: #ecf0f1; --dark: #1a252f; --text: #333; --danger: #e74c3c; --success: #27ae60; --warning: #f39c12; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f4f7f6; color: var(--text); line-height: 1.6; min-height: 100vh; }
        .translate-container { position: fixed; top: 20px; right: 20px; z-index: 9999; background: white; padding: 8px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #eee; }
        .goog-te-gadget-simple { background: transparent !important; border: none !important; padding: 0 !important; font-size: 14px !important; }
        .goog-te-banner-frame { display: none !important; }
        body { top: 0 !important; }
        .admin-controls { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 1000; align-items: flex-end; }
        .fab-btn { background: var(--accent); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s; border: none; font-size: 1.2rem; }
        .fab-btn:hover { transform: scale(1.1); }
        #save-btn, #logout-btn, #reset-btn { display: none; } /* On cache les boutons admin par d√©faut */
        #save-btn { background: var(--success); }
        #logout-btn { background: var(--danger); }
        #reset-btn { background: #c0392b; }
        .editable { border: 1px dashed var(--accent); background: rgba(52, 152, 219, 0.05); padding: 2px; transition: background 0.2s; cursor: text; }
        .editable:focus { background: white; outline: 2px solid var(--accent); border: none; }
        .btn-action { display: none; cursor: pointer; border: none; color: white; border-radius: 5px; padding: 5px 10px; font-size: 0.8rem; margin-top: 5px; }
        .btn-delete { background-color: var(--danger); position: absolute; right: -10px; top: -10px; border-radius: 50%; width: 25px; height: 25px; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn-add { background-color: var(--success); width: 100%; margin-top: 15px; padding: 10px; display: none; text-align: center; }
        .btn-add:hover { background-color: #219150; }
        
        /* Affichage conditionnel quand connect√© */
        body.logged-in .btn-delete { display: flex; z-index: 10; }
        body.logged-in .btn-add { display: block; }
        body.logged-in .timeline-item, body.logged-in .category-box, body.logged-in .skill-tag-wrapper, body.logged-in .project-card, body.logged-in .cert-item { border: 1px solid #ddd; padding: 10px; margin-bottom: 20px; border-radius: 8px; background: #fff; }
        body.logged-in #save-btn { display: flex; }
        body.logged-in #logout-btn { display: flex; }
        body.logged-in #login-btn { display: none; } /* Cache le bouton login si connect√© */
        
        body.logged-in #reset-btn { display: flex; } /* Ajouter l'affichage du bouton reset quand connect√© */

        /* LAYOUT (Reste du CSS inchang√©) */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 300px 1fr; gap: 30px; padding-top: 80px; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
        .sidebar { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; }
        .profile-wrapper { position: relative; display: inline-block; width: 150px; height: 150px; margin-bottom: 20px; }
        .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent); }
        .upload-btn { position: absolute; bottom: 5px; right: 5px; background: var(--primary); color: white; width: 35px; height: 35px; border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white; }
        body.logged-in .upload-btn { display: flex; }
        .name { font-size: 1.8rem; color: var(--primary); font-weight: 700; margin-bottom: 5px; }
        .title { font-size: 1rem; color: var(--accent); font-weight: 600; margin-bottom: 20px; }
        .contact-info { text-align: left; margin-top: 20px; font-size: 0.9rem; }
        .contact-item { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .contact-item i { color: var(--accent); width: 20px; }
        .cv-download-wrapper { margin-top: 20px; margin-bottom: 20px; }
        .btn-cv { display: inline-flex; align-items: center; gap: 10px; background: var(--primary); color: white; padding: 10px 20px; border-radius: 30px; text-decoration: none; font-weight: bold; transition: all 0.3s; border: 2px solid var(--primary); cursor: pointer; }
        .btn-cv:hover { background: transparent; color: var(--primary); }
        .btn-cv.upload-mode { background: var(--warning); border-color: var(--warning); }
        .btn-cv.upload-mode:hover { background: transparent; color: var(--warning); }
        .skills-list { text-align: left; margin-top: 30px; display: flex; flex-wrap: wrap; gap: 5px; }
        .skill-tag { background: var(--light); color: var(--dark); padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; }
        .skill-tag-wrapper { position: relative; display: inline-block; } 
        .main-content { display: flex; flex-direction: column; gap: 30px; }
        .section { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .section-title { font-size: 1.4rem; color: var(--primary); border-bottom: 2px solid var(--light); padding-bottom: 10px; margin-bottom: 20px; }
        .timeline-item { border-left: 3px solid var(--accent); padding-left: 20px; margin-bottom: 25px; position: relative; }
        body.logged-in .timeline-item { border-left: none; }
        .job-title { font-weight: bold; font-size: 1.1rem; }
        .company { color: #666; font-style: italic; font-size: 0.95rem; margin-bottom: 5px; }
        .date { font-size: 0.85rem; color: #999; margin-bottom: 10px; display: block; }
        .description ul { list-style-position: inside; margin-top: 5px; }
        .category-box { margin-bottom: 20px; position: relative; }
        .category-title { font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .status-badge { background: #27ae60; color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; display: inline-block; margin-bottom: 15px;}
        .project-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .project-card { background: #f9f9f9; padding: 20px; border-radius: 8px; border: 1px solid #eee; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
        .project-header h3 { font-size: 1.1rem; color: var(--primary); margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .project-desc { font-size: 0.9rem; color: #555; margin-bottom: 15px; }
        .project-tech { font-size: 0.8rem; color: var(--accent); margin-bottom: 15px; font-style: italic; }
        .project-link { text-decoration: none; background: var(--accent); color: white; padding: 5px 15px; border-radius: 5px; font-size: 0.85rem; display: inline-block; text-align: center; width: fit-content;}
        .project-link:hover { background: var(--primary); }
        .cert-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .cert-item { background: #f9f9f9; padding: 15px; border-radius: 8px; display: flex; flex-direction: column; gap: 10px; position: relative; border-left: 4px solid var(--accent); }
        .cert-name { font-weight: 600; font-size: 0.95rem; }
        .cert-link { font-size: 0.8rem; color: var(--accent); text-decoration: none; display: flex; align-items: center; gap: 5px; }
        .cert-link:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <div class="translate-container"><div id="google_translate_element"></div></div>
    <div id="app"></div>

    <div class="admin-controls">
        <button id="logout-btn" class="fab-btn" onclick="logout()" title="D√©connexion"><i class="fas fa-sign-out-alt"></i></button>
        <button id="reset-btn" class="fab-btn" onclick="resetDatabase()" title="R√©initialiser (Remettre √† z√©ro)"><i class="fas fa-trash-restore"></i></button>
        <button id="save-btn" class="fab-btn" onclick="saveDataToSupabase()" title="Sauvegarder en ligne"><i class="fas fa-save"></i></button>
        <button id="login-btn" class="fab-btn" onclick="login()" title="Connexion Admin"><i class="fas fa-pen"></i></button>
    </div>

    <script>
        // ==========================================
        // 1. SUPABASE CONFIGURATION
        // ==========================================
        // ‚ö†Ô∏è REMPLACEZ CES VALEURS PAR LES V√îTRES
        const SUPABASE_URL = "https://ofjbztpsifilkptuhhit.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mamJ6dHBzaWZpbGtwdHVoaGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjY4NzQsImV4cCI6MjA4Mzk0Mjg3NH0.NQDJYOPHYtQsP-XH3FVa_yYzenSzKfkO7iBu1q8dy8M";

        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const DB_TABLE = 'portfolio';
        const STORAGE_BUCKET = 'uploads';
        const CV_ID = 1;

        // ==========================================
        // 2. DONN√âES PAR D√âFAUT (VOTRE CV)
        // ==========================================
        const DEFAULT_DATA = {
            "personal": {
                "name": "Assami BAGA",
                "title": "Ing√©nieur IA & Full Stack",
                "availability": "Disponible d√®s octobre 2026",
                "email": "bagaassami09@gmail.com",
                "phone": "07 53 49 67 71",
                "location": "Thiais (94320), Ile de france",
                "linkedin": "assami-baga",
                "social": "bagus_full_stack",
                "summary": "√âtudiant en derni√®re ann√©e du cycle d'ing√©nieur en informatique √† l'EILCO, je suis √† la recherche active d'un CDI. Mon objectif est d'exploiter ma passion pour la technologie en participant √† la conception et au d√©veloppement d'applications de haute qualit√©.",
                "photoUrl": "",
                "cvUrl": ""
            },
            "softSkills": ["Polyvalence", "Efficacit√©", "Cr√©ativit√©", "Adaptabilit√©", "Collaboration", "Autonomie", "Curiosit√©"],
            "languages": ["Fran√ßais", "Anglais"],
            "education": [
                { "degree": "Dipl√¥me d'ing√©nieur en Ing√©nierie Logicielle et IA", "school": "EILCO, Calais, France", "date": "Depuis septembre 2023" },
                { "degree": "Certifications: PUPA, LCB-FT, HDS, ISO 27001", "school": "CDC Informatique, Bagneux", "date": "Jan 2025 - D√©c 2025" },
                { "degree": "RGPD, Protection des donn√©es, S√©curit√© incendie", "school": "CDC Informatique, Bagneux", "date": "Jan 2024 - D√©c 2024" },
                { "degree": "Technologie IP, SQL, Linux, Scripting Shell", "school": "Essitech, Ouagadougou", "date": "Juin 2023" },
                { "degree": "Licence en Ing√©nierie des Syst√®mes d'Information", "school": "ESI, Burkina Faso", "date": "Oct 2019 - F√©v 2023" }
            ],
            "experience": [
                {
                    "role": "Ing√©nieur Exploitation",
                    "company": "CDC Informatique, Bagneux",
                    "date": "Depuis septembre 2024",
                    "tasks": ["Participer √† un travail collaboratif", "R√©alisation de PYMQCOPY", "R√©alisation d'un R√©f√©rentiel des Services Flux (en cours)"]
                },
                {
                    "role": "B√©n√©volat (Accompagnement scolaire)",
                    "company": "AFEV Calais",
                    "date": "Sept 2023 - Sept 2024",
                    "tasks": ["Accompagnement des jeunes en difficult√© scolaire", "Cr√©ation de lien dans les quartiers populaires"]
                },
                {
                    "role": "Software Engineer",
                    "company": "Orange & Smile, Ouagadougou",
                    "date": "Sept 2022 - Sept 2023",
                    "tasks": ["D√©veloppement d'un Syst√®me Intelligent de Conception des Produits", "Participation au d√©veloppement de MySpace (Frontend)", "Participation au d√©veloppement de BourseFondation (Backend)"]
                }
            ],
            "techSkills": [
                { "cat": "Dev Multiplateforme", "tools": "HTML, CSS, JS, TS, SASS, Bootstrap, Tailwind, WordPress, Flutter Flow, Java, Pygame, JavaFX, Angular, React, Kotlin, Docker" },
                { "cat": "API RESTFUL", "tools": "NodeJS, ExpressJS, Spring, FastAPI, Laravel, Keycloak, JWT, Postman, Git, Swagger" },
                { "cat": "Conception & Modeling", "tools": "UML, Merise, Scrum, Power AMC, Adobe XD, Figma, JSON, XML" },
                { "cat": "Data & AI", "tools": "CNN, RNN, TensorFlow, Scikit-learn, PyTorch, YOLO, Pandas, NumPy, Matplotlib, Power BI" },
                { "cat": "Databases", "tools": "MySQL, MariaDB, PostgreSQL, Oracle Database, SQL Server" },
                { "cat": "Languages", "tools": "C, Java, Javascript, Python, R, PHP, Kotlin, Bash, Arduino, VHDL" }
            ],
            "projects": [
                { "name": "Blue Attendance", "desc": "Liste de pr√©sence √©lectronique via Bluetooth (App Mobile).", "tech": "Java, Xml, FastAPI, Android Studio", "link": "#" },
                { "name": "PNP+", "desc": "Syst√®me Intelligent de Conception des Produits et Promotions.", "tech": "Angular, Spring boot, SQL", "link": "#" },
                { "name": "Myspace", "desc": "Plateforme SaaS compl√®te.", "tech": "React, Node.js, PostgreSQL", "link": "#" },
                { "name": "BourseFondation", "desc": "Plateforme SaaS compl√®te.", "tech": "React, Node.js, PostgreSQL", "link": "#" },
                { "name": "UI Calculator", "desc": "Application web UI UX Design.", "tech": "HTML, CSS, SCSS", "link": "#" },
                { "name": "UI Keyboard", "desc": "Application web UI UX Design.", "tech": "HTML, CSS, SCSS", "link": "#" },
                { "name": "Projet IOT", "desc": "Plateforme SaaS compl√®te IOT.", "tech": "React, Node.js, PostgreSQL", "link": "#" },
                { "name": "ESI Website", "desc": "Site web statique de l'ESI.", "tech": "HTML, CSS, Bootstrap", "link": "#" },
                { "name": "Checkers Game", "desc": "Jeu de dames en mode console.", "tech": "C, Linux", "link": "#" },
                { "name": "Todo List", "desc": "Todo-list avec auth et email verification.", "tech": "PHP, Laravel, Voyager", "link": "#" },
                { "name": "Technology Transfer", "desc": "Plateforme de transfert de technologies.", "tech": "HTML, CSS, Bootstrap, MySql", "link": "#" },
                { "name": "Spare", "desc": "Suivi budg√©taire (synchro bancaire).", "tech": "React, Node.js, Firebase", "link": "#" },
                { "name": "PYMQCOPY", "desc": "Recopie de messages MQ source vers destinations.", "tech": "Python, MQ Series, Bash", "link": "#" }
            ],
            "certifications": [
                { "name": "C", "link": "#" }, { "name": "HTML", "link": "#" }, { "name": "CSS", "link": "#" },
                { "name": "Javascript", "link": "#" }, { "name": "Java", "link": "#" }, { "name": "PHP", "link": "#" },
                { "name": "SQL", "link": "#" }, { "name": "Python for Beginner", "link": "#" },
                { "name": "Python Data Structures", "link": "#" }, { "name": "Coding marketers", "link": "#" },
                { "name": "Responsive Web Design", "link": "#" }, { "name": "Intro r√©f√©rentiel HDS & ISO 27001", "link": "#" },
                { "name": "Sensibilisation PUPA", "link": "#" }, { "name": "Fondamentaux de la LCB-FT", "link": "#" },
                { "name": "RGPD - Protection donn√©es", "link": "#" }, { "name": "Classification et protection donn√©es", "link": "#" },
                { "name": "D√©ontologie code", "link": "#" }, { "name": "Evacuation et s√©curit√© incendie", "link": "#" }
            ]
        };

        let user = null;
        let cvData = DEFAULT_DATA; // On initialise avec les donn√©es par d√©faut au cas o√π la base est vide

        // ==========================================
        // 3. AUTHENTIFICATION & CHARGEMENT
        // ==========================================

        async function init() {
            // V√©rifier la session
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session) {
                user = session.user;
                enableEditMode();
            }

            // Charger les donn√©es
            await loadData();
        }

        async function loadData() {
            try {
                // Tente de r√©cup√©rer les donn√©es en base
                const { data, error } = await supabaseClient.from(DB_TABLE).select('json_data').eq('id', CV_ID).single();
                
                if (data && data.json_data) {
                    console.log("‚úÖ Donn√©es charg√©es depuis Supabase");
                    cvData = data.json_data;
                } else {
                    console.log("‚ÑπÔ∏è Aucune donn√©e en base. Affichage des donn√©es par d√©faut.");
                    // Si l'utilisateur est admin, on propose d'initialiser la base
                    if (user) {
                        const initConfirm = confirm("La base de donn√©es est vide. Voulez-vous sauvegarder les donn√©es par d√©faut (votre CV) maintenant ?");
                        if(initConfirm) {
                            await saveDataToSupabase();
                        }
                    }
                }
                render();
            } catch (err) {
                console.warn("Erreur r√©seau ou base vide", err);
                render(); // Affiche DEFAULT_DATA
            }
        }

        async function login() {
            const email = prompt("Email Admin :");
            const password = prompt("Mot de passe :");
            if (!email || !password) return;

            const { data, error } = await supabaseClient.auth.signInWithPassword({
                email: email,
                password: password,
            });

            if (error) {
                alert("‚ùå Erreur : " + error.message);
            } else {
                user = data.user;
                enableEditMode();
                alert("‚úÖ Connect√© !");
                // Recharger les donn√©es pour v√©rifier si on doit initialiser
                loadData();
            }
        }

        async function logout() {
            await supabaseClient.auth.signOut();
            user = null;
            disableEditMode();
            alert("D√©connect√©.");
        }

        async function resetDatabase() {
            if (!user) return alert("Vous devez √™tre connect√© !");

            // Double confirmation pour s√©curit√©
            const confirmation = confirm("‚ö†Ô∏è ATTENTION IRR√âVERSIBLE !\n\nVous allez effacer toutes les donn√©es en ligne et r√©tablir le CV par d√©faut.\n\n√ätes-vous s√ªr de vouloir continuer ?");
            
            if (!confirmation) return;

            // On √©crase la base de donn√©es avec DEFAULT_DATA
            const { error } = await supabaseClient
                .from(DB_TABLE)
                .upsert({ id: CV_ID, json_data: DEFAULT_DATA });

            if (error) {
                alert("‚ùå Erreur : " + error.message);
            } else {
                alert("‚ôªÔ∏è Base de donn√©es r√©initialis√©e avec succ√®s !");
                
                // On met √† jour l'affichage local imm√©diatement
                // On utilise JSON.parse/stringify pour cr√©er une copie propre des donn√©es par d√©faut
                cvData = JSON.parse(JSON.stringify(DEFAULT_DATA));
                render();
            }
        }

        function enableEditMode() {
            document.body.classList.add('logged-in');
            render();
        }

        function disableEditMode() {
            document.body.classList.remove('logged-in');
            render();
        }

        // ==========================================
        // 4. SAUVEGARDE
        // ==========================================

        async function saveDataToSupabase() {
            if (!user) return alert("Vous devez √™tre connect√© pour sauvegarder !");

            const { error } = await supabaseClient
                .from(DB_TABLE)
                .upsert({ id: CV_ID, json_data: cvData });

            if (error) {
                alert("‚ùå Erreur de sauvegarde : " + error.message);
            } else {
                alert("‚úÖ Donn√©es sauvegard√©es sur Supabase !");
            }
        }

        async function uploadFileToSupabase(file) {
            if (!user) return null;
            const fileName = `${Date.now()}_${file.name.replace(/\s/g, '_')}`;
            
            const { data, error } = await supabaseClient.storage.from(STORAGE_BUCKET).upload(fileName, file);
            if (error) {
                alert("Erreur upload : " + error.message);
                return null;
            }

            const { data: publicUrlData } = supabaseClient.storage.from(STORAGE_BUCKET).getPublicUrl(fileName);
            return publicUrlData.publicUrl;
        }

        // ==========================================
        // 5. RENDER (VOTRE DESIGN)
        // ==========================================
        
        function render() {
            const app = document.getElementById('app');
            const isEditing = !!user;
            const editClass = isEditing ? 'editable' : '';
            const contentEditable = isEditing ? 'contenteditable="true"' : '';
            const delBtn = (type, index) => `<button class="btn-action btn-delete" onclick="deleteItem('${type}', ${index})"><i class="fas fa-trash"></i></button>`;

            const p = cvData.personal || {};
            const photoSrc = p.photoUrl || 'https://via.placeholder.com/150';
            const cvLink = p.cvUrl || '#';

            app.innerHTML = `
                <div class="container">
                    <aside class="sidebar">
                        <div class="profile-wrapper">
                            <img src="${photoSrc}" alt="Profile" id="profile-img" class="profile-img">
                            <label for="photo-upload" class="upload-btn"><i class="fas fa-camera"></i></label>
                            <input type="file" id="photo-upload" accept="image/*" style="display:none">
                        </div>
                        <h1 class="name ${editClass}" ${contentEditable} oninput="updatePersonal('name', this.innerText)">${p.name}</h1>
                        <p class="title ${editClass}" ${contentEditable} oninput="updatePersonal('title', this.innerText)">${p.title}</p>
                        <div class="status-badge ${editClass}" ${contentEditable} oninput="updatePersonal('availability', this.innerText)">${p.availability}</div>
                        
                        <div class="contact-info">
                            <div class="contact-item"><i class="fas fa-envelope"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('email', this.innerText)">${p.email}</span></div>
                            <div class="contact-item"><i class="fas fa-phone"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('phone', this.innerText)">${p.phone}</span></div>
                            <div class="contact-item"><i class="fas fa-map-marker-alt"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('location', this.innerText)">${p.location}</span></div>
                            <div class="contact-item"><i class="fab fa-linkedin"></i> <span class="${editClass}" ${contentEditable} oninput="updatePersonal('linkedin', this.innerText)">${p.linkedin}</span></div>
                        </div>
                        <div class="cv-download-wrapper">
                            <a href="${cvLink}" id="cv-download-btn" class="btn-cv ${isEditing ? 'upload-mode' : ''}" ${isEditing ? 'onclick="document.getElementById(\'cv-upload\').click(); return false;"' : 'target="_blank"'}>
                                <i class="fas ${isEditing ? 'fa-file-upload' : 'fa-download'}"></i> ${isEditing ? 'Uploader CV (PDF)' : 'T√©l√©charger mon CV'}
                            </a>
                            <input type="file" id="cv-upload" accept="application/pdf" style="display:none">
                        </div>
                        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                        <h3>Atouts</h3>
                        <div class="skills-list">${(cvData.softSkills || []).map((s, i) => `<div class="skill-tag-wrapper"><span class="skill-tag ${editClass}" ${contentEditable} oninput="updateArrayItem('softSkills', ${i}, null, this.innerText)">${s}</span>${delBtn('softSkills', i)}</div>`).join('')}</div>
                        <button class="btn-action btn-add" onclick="addItem('softSkills')"><i class="fas fa-plus"></i> Ajouter</button>
                        <h3 style="margin-top:20px">Langues</h3>
                        <div class="skills-list">${(cvData.languages || []).map((s, i) => `<div class="skill-tag-wrapper"><span class="skill-tag ${editClass}" ${contentEditable} oninput="updateArrayItem('languages', ${i}, null, this.innerText)">${s}</span>${delBtn('languages', i)}</div>`).join('')}</div>
                        <button class="btn-action btn-add" onclick="addItem('languages')"><i class="fas fa-plus"></i> Ajouter</button>
                    </aside>
                    <main class="main-content">
                        <section class="section"><h2 class="section-title">√Ä propos de moi</h2><p class="${editClass}" ${contentEditable} oninput="updatePersonal('summary', this.innerText)">${p.summary}</p></section>
                        <section class="section"><h2 class="section-title">üèÜ Projets Phares</h2><div class="project-grid">${(cvData.projects || []).map((proj, i) => `<div class="project-card">${delBtn('projects', i)}<div class="project-header"><h3 class="${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'name', this.innerText)"><i class="fas fa-robot"></i> ${proj.name}</h3></div><p class="project-desc ${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'desc', this.innerText)">${proj.desc}</p><div class="project-tech ${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'tech', this.innerText)">${proj.tech}</div><a href="#" class="project-link" ${isEditing ? 'onclick="event.preventDefault();"' : ''}><span class="${editClass}" ${contentEditable} oninput="updateArrayItem('projects', ${i}, 'link', this.innerText)">${isEditing ? proj.link : 'Voir le projet'}</span></a></div>`).join('')}</div><button class="btn-action btn-add" onclick="addItem('projects')"><i class="fas fa-plus"></i> Ajouter un projet</button></section>
                        <section class="section"><h2 class="section-title">üìä Mes Certifications</h2><div class="cert-grid">${(cvData.certifications || []).map((cert, i) => `<div class="cert-item">${delBtn('certifications', i)}<div class="cert-name ${editClass}" ${contentEditable} oninput="updateArrayItem('certifications', ${i}, 'name', this.innerText)">${cert.name}</div><a href="#" class="cert-link" ${isEditing ? 'onclick="event.preventDefault();"' : ''}><i class="fas fa-external-link-alt"></i> <span class="${editClass}" ${contentEditable} oninput="updateArrayItem('certifications', ${i}, 'link', this.innerText)">${isEditing ? cert.link : 'Voir le certificat'}</span></a></div>`).join('')}</div><button class="btn-action btn-add" onclick="addItem('certifications')"><i class="fas fa-plus"></i> Ajouter une certification</button></section>
                        <section class="section"><h2 class="section-title">Comp√©tences Techniques</h2><div class="tech-grid">${(cvData.techSkills || []).map((skill, i) => `<div class="category-box">${delBtn('techSkills', i)}<div class="category-title ${editClass}" ${contentEditable} oninput="updateArrayItem('techSkills', ${i}, 'cat', this.innerText)">${skill.cat}</div><div class="category-content ${editClass}" ${contentEditable} oninput="updateArrayItem('techSkills', ${i}, 'tools', this.innerText)">${skill.tools}</div></div>`).join('')}</div><button class="btn-action btn-add" onclick="addItem('techSkills')"><i class="fas fa-plus"></i> Ajouter</button></section>
                        <section class="section"><h2 class="section-title">Exp√©riences Professionnelles</h2>${(cvData.experience || []).map((exp, i) => `<div class="timeline-item">${delBtn('experience', i)}<div class="job-title ${editClass}" ${contentEditable} oninput="updateArrayItem('experience', ${i}, 'role', this.innerText)">${exp.role}</div><div class="company ${editClass}" ${contentEditable} oninput="updateArrayItem('experience', ${i}, 'company', this.innerText)">${exp.company}</div><span class="date ${editClass}" ${contentEditable} oninput="updateArrayItem('experience', ${i}, 'date', this.innerText)">${exp.date}</span><div class="description"><ul>${(exp.tasks || []).map((t, ti) => `<li class="${editClass}" ${contentEditable} oninput="updateTask(${i}, ${ti}, this.innerText)">${t}</li>`).join('')}</ul></div></div>`).join('')}<button class="btn-action btn-add" onclick="addItem('experience')"><i class="fas fa-plus"></i> Ajouter</button></section>
                        <section class="section"><h2 class="section-title">Dipl√¥mes et Formations</h2>${(cvData.education || []).map((edu, i) => `<div class="timeline-item">${delBtn('education', i)}<div class="job-title ${editClass}" ${contentEditable} oninput="updateArrayItem('education', ${i}, 'degree', this.innerText)">${edu.degree}</div><div class="company ${editClass}" ${contentEditable} oninput="updateArrayItem('education', ${i}, 'school', this.innerText)">${edu.school}</div><span class="date ${editClass}" ${contentEditable} oninput="updateArrayItem('education', ${i}, 'date', this.innerText)">${edu.date}</span></div>`).join('')}<button class="btn-action btn-add" onclick="addItem('education')"><i class="fas fa-plus"></i> Ajouter</button></section>
                    </main>
                </div>
            `;
            attachListeners();
        }

        // ==========================================
        // 6. HELPER FUNCTIONS
        // ==========================================
        function updatePersonal(f, v) { cvData.personal[f] = v; }
        function updateArrayItem(arr, idx, f, v) { if(f) cvData[arr][idx][f] = v; else cvData[arr][idx] = v; }
        function updateTask(idx, tIdx, val) { cvData.experience[idx].tasks[tIdx] = val; }
        function addItem(type) {
            const map = { experience: { role: "Nouveau", company: "...", date: "...", tasks: ["..."] }, education: { degree: "...", school: "...", date: "..." }, techSkills: { cat: "...", tools: "..." }, projects: { name: "Projet", desc: "...", tech: "...", link: "#" }, certifications: { name: "...", link: "#" }, softSkills: "...", languages: "..." };
            if(!cvData[type]) cvData[type] = [];
            cvData[type].unshift(map[type]);
            render();
        }
        function deleteItem(t, i) { if(confirm("Supprimer?")) { cvData[t].splice(i, 1); render(); } }

        function attachListeners() {
            const pi = document.getElementById('photo-upload');
            if(pi) pi.onchange = async (e) => {
                const f = e.target.files[0];
                if(f) {
                    const url = await uploadFileToSupabase(f);
                    if(url) { cvData.personal.photoUrl = url; render(); }
                }
            };
            const ci = document.getElementById('cv-upload');
            if(ci) ci.onchange = async (e) => {
                const f = e.target.files[0];
                if(f) {
                    const url = await uploadFileToSupabase(f);
                    if(url) { cvData.personal.cvUrl = url; alert("CV Upload√© !"); render(); }
                }
            };
        }

        // D√©marrage
        init();
    </script>
    <script>function googleTranslateElementInit() { new google.translate.TranslateElement({pageLanguage: 'fr', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element'); }</script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>